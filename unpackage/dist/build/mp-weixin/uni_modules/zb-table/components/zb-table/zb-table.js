"use strict";const e=require("../../../../common/vendor.js"),t={components:{TableCheckbox:()=>"./components/table-checkbox.js",TableSummary:()=>"./components/table-summary.js",TableSideSummary:()=>"./components/table-side-summary.js",TableH5Summary:()=>"./components/table-h5-summary.js",ZbLoadMore:()=>"./components/zb-load-more.js"},props:{highlight:{type:Boolean,default:!1},itemDate:{type:Object,default:()=>{}},columns:{type:Array,default:()=>[]},showSummary:{type:Boolean,default:!1},isShowLoadMore:{type:Boolean,default:!1},data:{type:Array,default:()=>[]},sumText:{type:String,default:"合计"},showHeader:{type:Boolean,default:!0},border:{type:Boolean,default:!1},stripe:{type:Boolean,default:!0},fit:{type:Boolean,default:!1},rowKey:[String,Function],summaryMethod:Function,pullUpLoading:Function,formatter:Function,cellStyle:Function,cellHeaderStyle:Function,permissionBtn:Function},computed:{loadMoreHeight(){return this.isLoadMore?40:0},fixedLeftColumns(){let e=[];for(let t=0;t<this.columns.length;t++){let i=this.columns[t];if(!i.fixed)break;e.push(i)}return e},imgs:()=>e=>"string"==typeof e?[e]:e,itemfilters:()=>(e,t)=>null==e[t.name]?t.emptyString:e[t.name],scrollbarSize:()=>0,isFixedLeft(){if(!this.columns.length)return!1;if(!this.data.length)return!1;let[e]=this.columns;return!!e.fixed},transColumns(){this.fit&&this.columns.forEach((e=>{if("operation"===e.type&&e.renders){let t="";e.renders.map((e=>{t+=e.name})),e.width=this.getTextWidth(t)+40*e.renders.length}else if("img"===e.type);else if("selection"===e.type);else{let t=[this.getTextWidth(e.label)];this.data.forEach((i=>{let r=i[e.name]+"";if("undefined"===r)t.push(30);else{let e=this.getTextWidth(r);t.push(e)}})),e.width=Math.max(...t)+20}}));let e=0;return this.columns.forEach(((t,i)=>{if("operation"===t.type&&t.renders&&!t.width){let e="";t.renders.map((t=>{e+=t.name})),t.width=this.getTextWidth(e)+40*t.renders.length}if("img"===t.type&&!t.width){let e=[],i=this.getTextWidth(t.label);this.data.forEach((r=>{if(r[t.name]){let i="string"==typeof r[t.name]?[r[t.name]]:r[t.name];e.push(i.length)}t.width=40*Math.max(...e)+i}))}t.fixed&&(0===i?(t.left=0,e+=t.width):(t.left=e,e+=t.width)),t.emptyString=t.emptyString||"--"})),this.columns},transData(){let e=this.columns.some((e=>"selection"===e.type));if(this.data.forEach(((t,i)=>{e&&t.checked&&(this.selectArr.length||this.selectArr.push(t)),this.rowKey?"function"==typeof this.rowKey?t.key=Object.freeze(this.rowKey(t))||Date.now():t.key=Object.freeze(t[this.rowKey])||Date.now():t.key=i})),e)if(this.data.length){let e=this.data.filter((e=>e.checked)).length;e?e===this.data.length?this.checkedAll=!0:this.indeterminate=!0:(this.checkedAll=!1,this.indeterminate=!1,this.selectArr=[])}else this.checkedAll=!1,this.indeterminate=!1,this.selectArr=[];return this.data},isHighlight(){return(e,t)=>this.rowKey?e.key===this.currentRow.key:t===this.currentRowIndex},getHeaderCellStyle(){return(e,t,i)=>{const r=this.cellHeaderStyle;return"function"==typeof r?r({column:e,columnIndex:t}):{}}},getCellStyle(){return(e,t,i,r)=>{const l=this.cellStyle;return"function"==typeof l?l({row:e,column:t,rowIndex:i,columnIndex:r}):{}}}},data:()=>({button:[],alipayScrollTop:0,alipayScrollOldTop:0,alipayFlag:!1,bodyTableLeft:0,headerTableLeft:0,lastScrollLeft:0,isLoadMore:!1,headerFooterTableLeft:0,leftFiexScrollTop:0,bodyScrollTop:0,currentDriver:null,currentDriver1:null,bodyTime:null,currentRowIndex:null,currentRow:{},bodyTime1:null,headerTime:null,debounceTime:null,operation:{},completedFlag:!1,selectArr:[],indeterminate:!1,checkedAll:!1,completeLoading:!1,aliTime:null}),created(){},mounted(){},beforeDestroy(){this.aliTime&&clearTimeout(this.aliTime),this.debounceTime&&clearTimeout(this.debounceTime),this.bodyTime1&&clearTimeout(this.bodyTime1),this.bodyTime&&clearTimeout(this.bodyTime),this.selectArr=[],this.indeterminate=!1,this.checkedAll=!1},methods:{clearSelection(){this.transData.forEach((e=>{e.checked=!1})),this.selectArr=[],this.indeterminate=!1,this.checkedAll=!1},formatterAction(e,t,i,r){return t.formatter&&"function"==typeof this.formatter?this.formatter(e,t,i,r):null==e[t.name]||""===e[t.name]?t.emptyString:e[t.name]},permission(e,t,i){return this.permissionBtn&&"function"==typeof this.permissionBtn?this.permissionBtn(e,t,i):t},pullUpCompleteLoading(e){this.isLoadMore=!1,"ok"===e&&(this.completeLoading=!0)},scrollAlipay(e){this.alipayScrollOldTop||(this.alipayScrollOldTop=e.detail.scrollTop),this.aliTime&&clearTimeout(this.aliTime),this.aliTime=setTimeout((()=>{this.alipayFlag&&e.detail.scrollTop>this.alipayScrollOldTop&&this.pullLoad(),this.alipayFlag=!1,this.alipayScrollOldTop=null}),500)},pullLoad(){if(this.isShowLoadMore){this.isLoadMore=!0,this.$emit("pullUpLoading");let e=this;this.pullUpLoading&&this.pullUpLoading.call(this.$parent.$parent,(t=>{e.isLoadMore=!1,"ok"===t&&(e.completeLoading=!0)}))}},scrolltolower(e){this.alipayFlag=!0,"bottom"===e.detail.direction&&this.pullLoad()},previewImage(t,i,r){let l="string"==typeof i?[i]:i;e.index.previewImage({current:r,urls:l})},resetHighlight(){this.currentRowIndex=null,this.currentRow={}},cellClick(e,t,i){this.$emit("cellClick",e,t,i)},rowClick(e,t){this.highlight&&(this.currentRowIndex=t,this.currentRow=e,this.$emit("currentChange",e,t)),this.$emit("rowClick",e,t)},checkboxSelectedAll(e){this.indeterminate=!1,e.checked?(this.selectArr=[],this.checkedAll=!0,this.data.forEach((e=>{e.checked=!0,this.selectArr.push(e)}))):(this.checkedAll=!1,this.data.forEach((e=>{this.$set(e,"checked",!1)})),this.selectArr=[]),this.$forceUpdate(),this.$emit("toggleAllSelection",e.checked,this.selectArr)},checkboxSelected(e,t){this.data.forEach((t=>{t.key===e.data.key&&(t.checked=e.checked)})),t.checked=e.checked,e.data.checked=e.checked,e.checked?this.selectArr.push(e.data):this.selectArr=this.selectArr.filter((t=>t.key!==e.data.key)),this.selectArr.length===this.transData.length?(this.indeterminate=!1,this.checkedAll=!0):(this.indeterminate=!0,this.checkedAll=!1),this.selectArr.length||(this.checkedAll=!1,this.indeterminate=!1),this.$forceUpdate(),this.$emit("toggleRowSelection",e.checked,this.selectArr)},itemFilter(e,t){if(t.filters&&t.name){let i=e[t.name];return t.filters[i]||""}return e[t.name]||t.emptyString},getTextWidth(e){if(e.length<3)return 40;let t=/^[0-9]+.?[0-9]*$/,i=0;for(const r of e)r>="A"&&r<="Z"||r>="a"&&r<="z"?i+=10:r>="一"&&r<="龥"?i+=15:t.test(r)?i+=9:i+=7;return i},width:e=>`${e.width?e.width:"100"}px`,showStripe(e){if(!this.currentDriver)return this.stripe?e%2!=0?"odd":"even":""},checkNumber:e=>!!/^[0-9]+.?[0-9]*$/.test(e),isDate:e=>!(!isNaN(e)||isNaN(Date.parse(e))),sortAction(e,t){if(!e.sorter)return!1;this.$set(e,"sorterMode","_asc"===e.sorterMode?"_desc":"_asc"),"custom"===e.sorter?this.$emit("sort-change",e,e.sorterMode.replace("_",""),t):this.sortData(e),this.$forceUpdate()},sortData(e){let t=e.name;"_asc"===e.sorterMode?this.data.sort(((e,i)=>{if(this.checkNumber(e[t]))return e[t]-i[t];if(this.isDate(e[t])){return new Date(e[t]).getTime()-new Date(i[t]).getTime()}})):this.data.sort(((e,i)=>{if(this.checkNumber(e[t]))return i[t]-e[t];if(this.isDate(e[t])){let r=new Date(e[t]).getTime();return new Date(i[t]).getTime()-r}}))},throttle(e,t=60){let i=null;return(...r)=>{i||(i=setTimeout((()=>{e(...r),i=null}),t))}},debounce(e,t=1e3){return(...i)=>{this.debounceTime&&clearTimeout(this.debounceTime),this.debounceTime=setTimeout((()=>{e(...i)}),t)}},handleBodyScroll(e){this.currentDriver&&this.currentDriver!==e.currentTarget.id||(this.currentDriver=e.currentTarget.id,this.headerTableLeft=e.detail.scrollLeft,this.headerFooterTableLeft=e.detail.scrollLeft,this.leftFiexScrollTop=e.detail.scrollTop,this.bodyTime&&clearTimeout(this.bodyTime),this.bodyTime=setTimeout((()=>{this.currentDriver=null}),200))},leftFixedScrollAction(e){this.currentDriver&&this.currentDriver!==e.currentTarget.id||(this.currentDriver=e.currentTarget.id,this.bodyScrollTop=e.detail.scrollTop,this.bodyTime&&clearTimeout(this.bodyTime),this.bodyTime=setTimeout((()=>{this.currentDriver=null}),200))},scrollToLeft(e){this.currentDriver1&&this.currentDriver1!==e.currentTarget.id||(this.currentDriver1=e.currentTarget.id,"left"===e.detail.direction&&this.headerTableLeft<10?this.headerTableLeft=0:"top"===e.detail.direction&&this.leftFiexScrollTop<10&&(this.leftFiexScrollTop=0),this.bodyTime&&clearTimeout(this.bodyTime),this.bodyTime=setTimeout((()=>{this.currentDriver1=null}),200))},scrollToFixedLeft(e){this.currentDriver1&&this.currentDriver1!==e.currentTarget.id||(this.currentDriver1=e.currentTarget.id,"top"===e.detail.direction&&this.bodyScrollTop<10&&(this.bodyScrollTop=0),this.bodyTime&&clearTimeout(this.bodyTime),this.bodyTime=setTimeout((()=>{this.currentDriver1=null}),200))},handleTableScrollLeft(e,t){this.currentDriver&&this.currentDriver!==e.currentTarget.id||(this.currentDriver=e.currentTarget.id,this.bodyTableLeft=e.detail.scrollLeft,this.headerFooterTableLeft=e.detail.scrollLeft,this.bodyTime&&clearTimeout(this.bodyTime),this.bodyTime=setTimeout((()=>{this.currentDriver=null}),200))},handleFooterTableScrollLeft(e){this.currentDriver&&this.currentDriver!==e.currentTarget.id||(this.currentDriver=e.currentTarget.id,this.bodyTableLeft=e.detail.scrollLeft,this.headerTableLeft=e.detail.scrollLeft,this.bodyTime&&clearTimeout(this.bodyTime),this.bodyTime=setTimeout((()=>{this.currentDriver=null}),200))}}};if(!Array){(e.resolveComponent("tableCheckbox")+e.resolveComponent("table-summary")+e.resolveComponent("zb-load-more"))()}const i=e._export_sfc(t,[["render",function(t,i,r,l,o,s){return e.e({a:r.showHeader},r.showHeader?{b:e.f(s.transColumns,((t,i,r)=>e.e({a:"selection"===t.type},"selection"===t.type?{b:e.o(s.checkboxSelectedAll,i),c:"6252a029-0-"+r,d:e.p({indeterminate:o.indeterminate,checked:o.checkedAll})}:e.e({e:e.t(t.label||""),f:t.sorter},t.sorter?{g:e.n("_asc"===t.sorterMode&&`sorting${t.sorterMode||""}`),h:e.n("_desc"===t.sorterMode&&`sorting${t.sorterMode||""}`)}:{}),{i:e.o((e=>s.sortAction(t,i)),i),j:e.n(i<s.fixedLeftColumns.length&&"zb-stick-side"),k:`${t.left}px`,l:`${t.width?t.width:"100"}px`,m:i===s.transColumns.length-1?1:"none",n:`${t.width?t.width:"100"}px`,o:t.align||"left",p:i}))),c:""+(r.border?"1px solid #e8e8e8":""),d:""+(r.border?"1px solid #e8e8e8":"")}:{},{e:!r.data.length},(r.data.length,{}),{f:e.f(s.transData,((i,l,o)=>({a:e.f(s.transColumns,((n,a,h)=>e.e({a:"operation"===n.type},"operation"===n.type?{b:e.f(s.permission(i,n.renders,l),((r,o,s)=>e.e({a:"custom"===r.type},"custom"===r.type?{b:e.t(r.name),c:e.n(r.class||"")}:{d:e.t(r.name),e:e.n(r.class||""),f:r.type||"primary",g:r.size||"mini"},{h:o,i:e.o((e=>t.$emit(r.func,i,l)),o)}))),c:n.renders.length>1?"8px":"0"}:"selection"===n.type?{e:e.o((e=>s.checkboxSelected(e,i)),a),f:"6252a029-1-"+o+"-"+h,g:e.p({cellData:i,checked:i.checked})}:"img"===n.type?e.e({i:i[n.name]},i[n.name]?{j:e.f(s.imgs(i[n.name]),((t,r,l)=>({a:e.o((e=>s.previewImage(t,i[n.name],r)),r),b:r,c:t}))),k:e.o((()=>{}),a)}:{l:e.t(n.emptyString)}):"index"===n.type?{n:e.t(l+1)}:{o:e.t(n.filters?s.itemFilter(i,n):s.formatterAction(i,n,l,a))},{d:"selection"===n.type,h:"img"===n.type,m:"index"===n.type,p:e.s({left:`${n.left}px`,width:`${n.width?n.width:"100"}px`,flex:a===s.transColumns.length-1?1:"none",minWidth:`${n.width?n.width:"100"}px`,borderRight:""+(r.border?"1px solid #e8e8e8":""),textAlign:n.align||"left"}),q:e.s(s.getCellStyle(i,n,l,a)),r:e.o((e=>s.cellClick(i,l,n)),a),s:e.n(a<s.fixedLeftColumns.length&&"zb-stick-side"),t:a}))),b:e.n(r.stripe?l%2!=0?"odd":"even":""),c:e.n(r.highlight&&s.isHighlight(i,l)?"current-row":""),d:e.o((e=>s.rowClick(i,l)),i.key),e:i.key}))),g:r.showSummary},r.showSummary?{h:e.p({data:r.data,showSummary:r.showSummary,fixedLeftColumns:s.fixedLeftColumns,transColumns:s.transColumns,border:r.border,"summary-method":r.summaryMethod,sumText:r.sumText})}:{},{i:e.o(((...e)=>s.scrolltolower&&s.scrolltolower(...e))),j:o.isLoadMore&&!o.completeLoading},(o.isLoadMore&&o.completeLoading,{}))}],["__scopeId","data-v-6252a029"]]);wx.createComponent(i);
